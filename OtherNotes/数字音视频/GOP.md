[TOC]

#GOP (group of pictures)

视频是利用人眼视觉暂留的原理，通过播放一系列的图片，使人眼产生运动的感觉。单纯传输视频画面，视频量非常大，对现有的网络和存储来说是不可接受的。为了能够使视频便于传输和存储，人们发现视频有大量重复的信息，如果将重复信息在发送端去掉，在接收端恢复出来，这样就大大减少了视频数据的文件，因此有了H.264, H.265, Mpeg等视频压缩标准。

__编码器将多张图像进行编码后生产成一段一段的 GOP ( Group of Pictures ) ， 解码器在播放时则是读取一段一段的 GOP 进行解码后读取画面再渲染显示。__

GOP ( Group of Pictures) 是一组连续的画面，由一张 I 帧和数张 B / P 帧组成，是视频图像编码器和解码器存取的基本单位，它的排列顺序将会一直重复到影像结束。

__I 帧是内部编码帧(也称为关键帧)，P帧是前向预测帧(前向参考帧)，B 帧是双向内插帧(双向参考帧)__

__数据大小: I > P > B__
![](img\1.png)

### I 帧 

Intra-coded picture, 帧内编码图像帧。 __解码时只需要本帧数据就可以完成（因为包含完整画面）__   
I 帧通常是每个 GOP（MPEG 所使用的一种视频压缩技术）的第一个帧，经过适度地压缩，做为随机访问的参考点，可以当成图象。

I帧法是基于离散余弦变换DCT（Discrete Cosine Transform）的压缩技术，这种算法与JPEG压缩算法类似。采用I帧压缩可达到1/6的压缩比而无明显的压缩痕迹

* __I帧是P帧和B帧的参考帧(其质量直接影响到同组中以后各帧的质量)__
* __I帧描述了图像背景和运动主体的详情__
* __I帧不需要考虑运动矢量;__

举例: 视频会议系统(允许延迟)。在视频画面播放过程中，若I帧丢失了，则后面的P帧也就随着解不出来，就会出现视频画面黑屏的现象；若P帧丢失了，则视频画面会出现花屏、马赛克等现象。

__在视频会议系统中I帧只会在会议限定的带宽内发生，不会超越会议带宽而生效。I帧机制不仅存在于MCU中，电视墙服务器、录播服务器中也存在。就是为了解决在网络状况不好的情况下，出现的丢包而造成的如图像花屏、卡顿，而影响会议会正常进行。__

### P 帧 

Predictive-coded Picture,前向预测编码图像帧。__P帧表示的是这一帧跟之前的一个关键帧（或P帧）的差别，解码时需要用之前缓存的画面叠加上本帧定义的差别，生成最终画面。__

P帧是以I帧为参考帧,在I帧中找出P帧“某点”的预测值和运动矢量,取预测差值和运动矢量一起传送。在接收端根据运动矢量从I帧中找出P帧“某点”的预测值并与差值相加以得到P帧“某点”样值,从而可得到完整的P帧。

* __P帧采用运动补偿的方法传送它与前面的I或P帧的差值及运动矢量(预测误差)__
* __P帧属于前向预测的帧间编码。它只参考前面最靠近它的I帧或P帧__
* __由于P帧是参考帧,它可能造成解码错误的扩散__

### B 帧 

Bidirectionally predicted picture,双向预测编码图像帧。__B帧是双向差别帧，也就是B帧记录的是本帧与前后帧的差别，换言之，要解码B帧，不仅要取得之前的缓存画面，还要解码之后的画面，通过前后画面的与本帧数据的叠加取得最终的画面。B帧压缩率高，但是解码时CPU需求大。__

B帧以前面的I或P帧和后面的P帧为参考帧,“找出”B帧“某点”的预测值和两个运动矢量,并取预测差值和运动矢量传送。接收端根据运动矢量在两个参考帧中“找出(算出)”预测值并与差值求和,得到B帧“某点”样值,从而可得到完整的B帧。采用运动预测的方式进行帧间双向预测编码

* __B帧传送的是它与前面的I帧或P帧和后面的P帧之间的预测误差及运动矢量__
* __B帧不是参考帧,不会造成解码错误的扩散__
* __B帧压缩比最高,因为它只反映两参考帧间运动主体的变化情况,预测比较准确__

__B帧意义:节省空间(数据量)__

举例:网络上的电影很多都采用了B帧，因为B帧记录的是前后帧的差别，比P帧能节约更多的空间，但这样一来，文件小了，解码器就麻烦了，因为在解码时，不仅要用之前缓存的画面，还要知道下一个I或者P的画面（也就是说要预读预解码），而且，B帧不能简单地丢掉，因为B帧其实也包含了画面信息，如果简单丢掉，并用之前的画面简单重复，就会造成画面卡（其实就是丢帧了），并且由于网络上的电影为了节约空间，往往使用相当多的B帧，B帧用的多，对不支持B帧的播放器就造成更大的困扰，画面也就越卡。

### 常见参数意义

* GOP即Group of picture（图像组），指两个I帧之间的距离
* Reference（参考周期）指两个P帧之间的距离。
* DTS（Decoding Time Stamp）即解码时间戳,播放器该在什么时候解码这一帧的数据。
* PTS（Presentation Time Stamp）显示时间戳，播放器该在什么时候显示这一帧的数据

__DTS 和 PTS 见下图__    
![](img\2.png)
