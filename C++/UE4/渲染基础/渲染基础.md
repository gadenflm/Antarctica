# 渲染基础

## 理论

定义： 渲染是将3D场景转化成2D图像的一种技术。

* 写实主义(PBR): 追求真实还原现实世界，例子：荒野大嫖客
* 非写实主义(NPR): 用偏艺术的表达方式，例子：原神

### 物理/数学

光照反射的三种模型：

* 漫反射：入射点和出射点比较近
* 镜面反射：亮斑
* 折射：用的较少

数学相关：

* 笛卡尔坐标系下，矩阵运算 实现 平移、旋转等等
* 坐标空间变换

### GPU 管线和着色模型

CPU端Applicaition 将参数整理好，发送到GPU端，GPU先整理好顶点，GPU 接着将顶点在正确的空间位置组装成三角形。 接着使用GPU的独特技术 光栅化(通过对顶点图元的插值，决定屏幕上的像素如何去绘制，哪些要绘制)，将三角形组装成像素(此过程可以硬件MSA 负责 抗锯齿, 也可以基于图像FFA 算法抗锯齿)，接着进入GPU对像素的着色阶段.

__现在可能还有并行计算等功能。__

__GPU 管线使用专门的编程语言。此处不展开。__

## 实践相关

### UE4 着色模型

__核心：对建立好的数学模型做数学计算简化。(即实际中往往不会对所有像素如 1920x1080 全部渲染)__

经验模型(计算简单但不符合物理定律): Phong / Blinn-Phong, 2010年前用的比较多

UE4 模型: Cook-Torrance

* 基于微平面(Microface)的表面模型
* 能量守恒
* 应用基于物理的BRDF

1. 正太分布函数：估计在受到表面粗糙度影响下的法线分布。  
2. 几何函数：描述微平面自成阴影的属性。  
3. 菲涅尔方程：描述不同的视角下反射光线所占的比率。  

### UE4 材质系统

对光的基础反射率取决于 材质的介电常数。

UE4的材质系统是 Disney 的简化版，设计思路如下：

* 直观
* 基于外观
* 易于插值
* 基于数据(物理真实)

课堂问题：对于漫射度非常大的材质(红砖), 高光=0 还是 粗糙度=1 ? 答案是两者都要调整，只修改一方会失真。

混合模式： 图像中两点像素重合了，如何处理该点的颜色值。

### 实践

1. 材质编辑器中，通过蓝图编程，实现HLSL代码

注意区分概念，在不同的抽象层次：
* 材质实例(顶层)
* __材质，材质图层__
* 材质表达式，材质函数(底层)

可以去了解: 
* UE4 自带 starter map(UE4附带地图， 里面有各种材质展示)
* UE4 文档 级联粒子系统(进阶)
* UE4 文档 使用蓝图和渲染目标创建流体表面(进一步进阶)

### 作业相关

可以使用默认材质丰富场景。
