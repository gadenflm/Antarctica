# 游戏物理

## 概念

### 举例
PhysX：
Nvidia 公司，开发的游戏 《PUBG》 《Unreal》

Bullet：
开源, 《GTA：V》

Havok：
微软， 《Half-life》 《The Elder Scrolls》

### UE
封装了 physX， 引擎层仅做接口调用，不涉及算法部分

同时新推出的 Chaos，但还在调试阶段，计划在 UE5 中替代 phyX

### physX：

physX 世界由多个scene组成，不同的Scene 互不影响。

每个Scene 由被称为 Actor 的物体组成, Actor 可以包含多个几何形状, 每个Actor 有对应的物理状态信息, 如位置、朝向、速度、动量 等等。

* static： 场景中的静态物体，质量可视为无穷大
* Dynamic： 场景中的动态物体，受物理模拟影响改变自身状态
* Kinematic： 可以直接移动位置, 可以视为质量无穷大， 常用于如玩家控制角色, 移动平台等。

### 包围盒：

简化相交运算， 把复杂物体包起来, 判断两 物体是否相交 , 可以先判断包围盒是否相交, 包围盒不相交则一定不相交。

有多种类型:  Shpere, AABB, OBB , DOP, Convex Hull.

### 相交判断
常用如下，如需使用需自己了解：

* 分离轴定理： 找到一个轴，若两个凸形状位于该轴上的投影不相交，则两个凸形状不相交。
* GJK 算法

### PhysX 碰撞查询

常用 3 种:
* Ray Cast: 常用于 子弹射中目标检测, 蓝图中为 `LineTraceXXXXX()`
* Sweep 扫掠: 玩家碰撞检测, 蓝图中为 `<形状名>TraceXXXXX()`
* Overlap 重叠: 手雷爆炸范围检测, 蓝图中为 `<形状名>OverlapXXXXX()`

### 空间划分

空间划分是一种性能优化策略.
不在同一个空间内的物体一定不会相交！

常用数据结构：
KD tree， OD tree， BSP tree.

### 演示

* 阻挡体积(BlockBoard) 产生空气墙
* 修改 Demo 中 凳子的各种碰撞
	- 简单碰撞： 生成各种凸包（玩家碰撞凳子）
	- 复杂碰撞: (子弹)
	- 碰撞响应： 让玩家、子弹和ShootBall 分别可以穿过凳子

* 玩家周围生成力场, 对物理形体产生升空力。(蓝图实现, 触发条件为  EventTick 和 一个自定义变量, 触发成功后绘制一个玩家周围的球体作为立场范围。在overlap 判定后，对物体施加一个向上的力)

## Physics Material

物理材质：定义物理对象与场景动态交互的方式。

* 表面类型： 用来播放不同声音、 射击贴花等等

### 演示

* 修改草坪材质，让射击命中后更改特效
* 用一个平板 和 一个落在平板上的盒子， 测试表面材质的摩擦力参数（需要设置盒子为物理引擎模拟对象）

## 物理动画

基于动画及真实物理模拟插值的动画系统，应用到骨骼模型上。

## 作业说明

1. 不同的地面有不同的摩擦力（挑一两个地方改一改即可，作业说明里说一下）
2. 步枪子弹击中垃圾桶，可以把垃圾桶打飞（打倒），（建议直接改C++代码，找到垃圾桶继承的类的射击行为，添加几个函数）
3. 修改炮弹轨迹，添加弹射等等(修改Proj Rocket的蓝图)
4. 二段跳 (修改 Bot Pawn 和 PlayPawn 的蓝图， 监听空格键，玩家正在下落为触发条件，物理查询接口，判断前方有没有墙，有墙继续触发弹跳)
5. 步枪子弹可以穿过一定厚度的墙，伤害递减(较难，C++ 蓝图 都可以，老师推荐C++， 做不出来在作业说明中写下思路也可以)